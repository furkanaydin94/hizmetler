<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sosyal Hizmetler Raporu</title>

    <!-- Harici Kütüphaneler -->
    <link rel="stylesheet" href="libs/leaflet.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Modüler CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/cover.css">
    <link rel="stylesheet" href="css/pages.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/flipbook.css">
    <link rel="stylesheet" href="css/print.css">

    <!-- StPageFlip Kütüphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>

    <!-- PDF İndirme -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="libs/html-to-image.js"></script>

    <!-- Harici JavaScript Kütüphaneleri -->
    <script src="libs/xlsx.full.min.js"></script>
    <script src="libs/leaflet.js"></script>
</head>

<body>
    <!-- Yükleme Ekranı -->
    <div id="flipbook-loading">
        <div class="spinner"></div>
        <p id="loading-message">Rapor oluşturuluyor...</p>
        <div id="error-message"
            style="display: none; color: #ef4444; margin-top: 20px; max-width: 80%; text-align: center; font-size: 14px;">
        </div>
    </div>

    <script>
        // Global error handler for debugging
        window.addEventListener('error', function (e) {
            const errorDiv = document.getElementById('error-message');
            const loadingMsg = document.getElementById('loading-message');
            if (errorDiv && loadingMsg) {
                loadingMsg.textContent = 'Hata oluştu:';
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `<strong>${e.message}</strong><br><small>${e.filename}:${e.lineno}</small>`;
            }
            console.error('Global error:', e);
        });

        window.addEventListener('unhandledrejection', function (e) {
            const errorDiv = document.getElementById('error-message');
            const loadingMsg = document.getElementById('loading-message');
            if (errorDiv && loadingMsg) {
                loadingMsg.textContent = 'Promise hatası:';
                errorDiv.style.display = 'block';
                errorDiv.textContent = e.reason?.message || e.reason || 'Bilinmeyen hata';
            }
            console.error('Unhandled promise rejection:', e);
        });
    </script>

    <!-- Flipbook Wrapper -->
    <div id="flipbook-wrapper">
        <!-- Flipbook Container -->
        <div id="flipbook-container">
            <div id="flipbook"></div>
        </div>

        <!-- Navigasyon Toolbar -->
        <div id="flipbook-toolbar">
            <button class="flipbook-btn nav-btn" id="btn-prev" title="Önceki Sayfa">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>

            <div id="page-indicator">1/1</div>

            <button class="flipbook-btn nav-btn" id="btn-next" title="Sonraki Sayfa">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>

            <div class="toolbar-divider"></div>

            <button class="flipbook-btn" id="btn-zoom-in" title="Yakınlaştır">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>

            <button class="flipbook-btn" id="btn-zoom-out" title="Uzaklaştır">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>

            <button class="flipbook-btn" id="btn-fullscreen" title="Tam Ekran">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <polyline points="9 21 3 21 3 15"></polyline>
                    <line x1="21" y1="3" x2="14" y2="10"></line>
                    <line x1="3" y1="21" x2="10" y2="14"></line>
                </svg>
            </button>

            <div class="toolbar-divider"></div>

            <button class="flipbook-btn" id="btn-print" title="Yazdır / PDF">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
            </button>
        </div>
    </div>

    <!-- Print için Gizli Rapor -->
    <div id="print-report"></div>

    <!-- Ana Uygulama Scripti -->
    <script src="js/app.js"></script>
</body>

</html>